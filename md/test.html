<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Marked in the browser</title>
  <link href="default.css" rel="stylesheet" />
    <link href="github-md.css" rel="stylesheet" />
    <script src="github-md.js"></script>
    <script src="tex-chtml.js"></script>
    <script src="jquery.min.js"></script>
    <script src="jquery.qrcode.min.js"></script>
</head>

<body>
    <div id="header"><div>By 折戟沉沙。丿</div></div>
    <div id="content"></div>
    <div id="footer">
        <div class="qrc"><div id="qrcode"></div></div>
        <div class="md-download"><a href="javascript:d()">点击下载</a></div>
    </div>
    <script src="marked.min.js"></script>
    <script>
        let val = "",
        url = ""
        // let val = "```c\nvoid multiply(char* num1, char* num2, char* result)\n{\n    int len1 = strlen(num1);\n    int len2 = strlen(num2);\n    int* num = (int*)calloc(len1 + len2, sizeof(int));\n\n    // 竖式计算乘积并存储在num数组中\n    for (int i = len1 - 1; i >= 0; i--)\n    {\n        for (int j = len2 - 1; j >= 0; j--)\n        {\n            int product = (num1[i] - '0') * (num2[j] - '0');\n            num[i + j + 1] += product % 10;\n            num[i + j] += product / 10;\n        }\n    }\n\n    // 处理进位\n    for (int i = len1 + len2 - 1; i > 0; i--)\n    {\n        if (num[i] >= 10)\n        {\n            num[i - 1] += num[i] / 10;\n            num[i] %= 10;\n        }\n    }\n\n    // 将num数组转换成字符串形式\n    int i = 0;\n    while (num[i] == 0 && i < len1 + len2 - 1)\n        i++;\n    for (int j = 0; i < len1 + len2; i++, j++)\n        result[j] = num[i] + '0';\n    result[len1 + len2 - i] = '\x00';\n    free(num);\n}\n```"
        
        if (!val) {
            const tex = location.search
            if (tex.startsWith('?tex=')) {
                val = decodeURI(atob(tex.substr(5)))
            }
        }
        if (!url) {
            url = "https://bincooo.github.io/vuepress-doc"
        }

        val = val.replaceAll(/([^$]{1})\$([^$]{1,})\$/g, '$$$$$2$$$$')
        document.getElementById('content').innerHTML=marked.parse(val);
        hljs.highlightAll();
        MathJax.typeset();
        let codes = document.querySelectorAll('code');
        codes.forEach(item => {
            let lang = item.classList[0]?.split('-')[1];
            if (lang) {
              item.title = `[lang: ${lang}]`;
            }
        });
        $('#qrcode').qrcode({
            width: 120,
            height: 120,
            background: "#f0f0f0",//背景颜色  
            foreground: "#000000", //前景颜色
            correctLevel :0,//纠错等级 
            text: url
        });

        function download(filename, text) {
          var element = document.createElement('a');
          element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
          element.setAttribute('download', filename);
          element.style.display = 'none';
          document.body.appendChild(element);
          element.click();
          document.body.removeChild(element);
        }

        function d() {
            download('marked.md', val);
        }
        // console.log('https://bincooo.github.com/qrcode?tex=' + btoa(encodeURI(val)))
    </script>
</body>

</html>